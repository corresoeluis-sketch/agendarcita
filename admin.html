<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin - Agenda</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-3">
  <div class="container">
    <h2>Panel Admin</h2>
    <p><a href="/logout" class="btn btn-sm btn-secondary">Cerrar sesiÃ³n</a></p>

    <h4>Agregar horario (slot)</h4>
    <form method="post" action="/admin/slots/add" class="row g-2 mb-3">
      <div class="col-md-3"><input class="form-control" type="date" name="date" required></div>
      <div class="col-md-3"><input class="form-control" type="time" name="time" required></div>
      <div class="col-md-4"><input class="form-control" name="note" placeholder="Nota (opcional)"></div>
      <div class="col-md-2"><button class="btn btn-success w-100" type="submit">Agregar</button></div>
    </form>

    <h4>Horarios (slots)</h4>
    <table class="table table-sm">
      <thead><tr><th>Fecha</th><th>Hora</th><th>Disponible</th><th>Acciones</th></tr></thead>
      <tbody>
      {% for s in slots %}
        <tr>
          <td>{{ s['date'] }}</td>
          <td>{{ s['time'] }}</td>
          <td>{{ 'SÃ­' if s['available'] else 'No' }}</td>
          <td>
            <form method="post" action="/admin/slots/toggle/{{ s['id'] }}" style="display:inline">
              <button class="btn btn-sm btn-warning">Toggle</button>
            </form>
            <form method="post" action="/admin/slots/delete/{{ s['id'] }}" style="display:inline" onsubmit="return confirm('Eliminar slot?')">
              <button class="btn btn-sm btn-danger">Eliminar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <h4 class="mt-4">Citas registradas</h4>
    <table class="table table-sm">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Email</th>
          <th>Fecha/Hora</th>
          <th>Notas</th>
          <th>Creada</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
      {% for a in appointments %}
        <tr>
          <td>{{ a['name'] }}</td>
          <td>{{ a['email'] }}</td>
          <td>{{ a['scheduled_at'] }}</td>
          <td>{{ a['notes'] }}</td>
          <td>{{ a['created_at'] }}</td>

          <!-- BOTÃ“N ELIMINAR CITA -->
          <td>
            <form action="{{ url_for('admin_delete_appointment', appointment_id=a['id']) }}"
                  method="POST"
                  style="display:inline;">
              <button type="submit"
                      onclick="return confirm('Â¿Seguro que deseas eliminar esta cita?');"
                      class="btn btn-sm btn-danger">
                ðŸ—‘ Eliminar
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <p><a href="/">Ver pÃ¡gina pÃºblica</a></p>
  </div>
</body>
</html>
